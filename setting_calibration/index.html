<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Project documentation for CWatM implementation in SpineToolbox"><meta name=author content="VTT DOES Team"><link href=https://jeanlouisnico.github.io/CWatM-spinetoolbox/setting_calibration/ rel=canonical><link href=../Tutorial/ rel=prev><link href=../example_models/ rel=next><link rel=icon href=../images/flex_cwatm_logo.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.21"><title>Setup for calibration - FlexTool - CWatM</title><link rel=stylesheet href=../assets/stylesheets/main.2a3383ac.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#setup-for-calibration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://jeanlouisnico.github.io/CWatM-spinetoolbox/ title="FlexTool - CWatM" class="md-header__button md-logo" aria-label="FlexTool - CWatM" data-md-component=logo> <img src=../images/flex_cwatm_logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> FlexTool - CWatM </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Setup for calibration </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jeanlouisnico/CWatM-spinetoolbox title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> jeanlouisnico/CWatM-spinetoolbox </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://jeanlouisnico.github.io/CWatM-spinetoolbox/ title="FlexTool - CWatM" class="md-nav__button md-logo" aria-label="FlexTool - CWatM" data-md-component=logo> <img src=../images/flex_cwatm_logo.png alt=logo> </a> FlexTool - CWatM </label> <div class=md-nav__source> <a href=https://github.com/jeanlouisnico/CWatM-spinetoolbox title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> jeanlouisnico/CWatM-spinetoolbox </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> About us </span> </a> </li> <li class=md-nav__item> <a href=../introduction/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../getting_started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../navigating/ class=md-nav__link> <span class=md-ellipsis> Navigating the workflow </span> </a> </li> <li class=md-nav__item> <a href=../Tutorial/ class=md-nav__link> <span class=md-ellipsis> Running standalone version </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Setup for calibration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Setup for calibration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#importing-calibration-settings class=md-nav__link> <span class=md-ellipsis> Importing calibration settings </span> </a> </li> <li class=md-nav__item> <a href=#calibration-database class=md-nav__link> <span class=md-ellipsis> Calibration Database </span> </a> </li> <li class=md-nav__item> <a href=#creating-a-calibration-scenario class=md-nav__link> <span class=md-ellipsis> Creating a calibration scenario </span> </a> </li> <li class=md-nav__item> <a href=#running-the-calibration class=md-nav__link> <span class=md-ellipsis> Running the calibration </span> </a> </li> <li class=md-nav__item> <a href=#results-and-running-best-calibration class=md-nav__link> <span class=md-ellipsis> Results and running best calibration </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../example_models/ class=md-nav__link> <span class=md-ellipsis> Coupling </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#importing-calibration-settings class=md-nav__link> <span class=md-ellipsis> Importing calibration settings </span> </a> </li> <li class=md-nav__item> <a href=#calibration-database class=md-nav__link> <span class=md-ellipsis> Calibration Database </span> </a> </li> <li class=md-nav__item> <a href=#creating-a-calibration-scenario class=md-nav__link> <span class=md-ellipsis> Creating a calibration scenario </span> </a> </li> <li class=md-nav__item> <a href=#running-the-calibration class=md-nav__link> <span class=md-ellipsis> Running the calibration </span> </a> </li> <li class=md-nav__item> <a href=#results-and-running-best-calibration class=md-nav__link> <span class=md-ellipsis> Results and running best calibration </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <div><h1 id=setup-for-calibration>Setup for calibration<a class=headerlink href=#setup-for-calibration title="Permanent link">¶</a></h1> <p>One important part in running hydrology model is the calibration of the model. We have also integrated this feature provided by CWatM for their model. However, this is more tedious setup as the calibration files are not ordered in a way that can be easily be put together. In this page, we will explain how to import calibration file and to which alternative, how to maintain the calibration files and run a calibration example. </p> <p><img alt=cwatm_integration src=../images/cwatm_integration.png></p> <h2 id=importing-calibration-settings>Importing calibration settings<a class=headerlink href=#importing-calibration-settings title="Permanent link">¶</a></h2> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>This section refers to the <a href=../navigating/#1-import-of-the-calibration-ini-file-into-the-database>importing the calibration ini file to Toolbox</a> part of the workflow</p> </div> <p>The calibration files coming with CWatM do not match the structure of Toolbox, therefore some changes were made in the init file provided by CWatM. The two important settings are the pathfiles (similar to the the cwatm init file), and in addition, a CALIBRATION section was added to set the variables that needs to be calibrated. CWatM does not perform this step as it assumes users will implement these changes manually in the cwatm init file. However, this step can be automated by selecting the variables that need to be calibrated through the calibration run. </p> <p>added section</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=k>[CALIBRATION]</span>
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=na>OUT_Dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%run_rand_id</span>
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=na>OUT_TSS_Daily</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>discharge</span>
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=na>OUT_TSS_MonthAvg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>discharge</span>
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=na>crop_correct</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=s>%crop</span>
</span><span id=__span-0-6><a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=na>soildepth_factor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%soildepthF</span>
</span><span id=__span-0-7><a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=na>preferentialFlowConstant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%pref</span>
</span><span id=__span-0-8><a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=na>arnoBeta_add</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%arnoB</span>
</span><span id=__span-0-9><a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=na>factor_interflow</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%interF</span>
</span><span id=__span-0-10><a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a><span class=na>recessionCoeff_factor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%reces</span>
</span><span id=__span-0-11><a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a><span class=na>manningsN</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%CCM</span>
</span><span id=__span-0-12><a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a><span class=na>normalStorageLimit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>%normalStorageLimit</span>
</span></code></pre></div> <p>One can also skip this step and include the CALIBRATION section manually from the database. However, if this section is added to the original init calibration file, it will be automatically be allocated to a separate alternative called <em>calibration</em></p> <ol> <li>select the data connection <img alt=connectionfile src=../images/input_setting_file_icon_small.png> and modify the path to the calibration init file. If nothing, there is a separate init file available in this repository under <em>calibration&gt;settings_calibration_SpineToolBox.txt</em></li> <li>ensure that the path to the file is correct in the first tool (convert_to_valid_toml (2))</li> <li>Set the parse_toml tool input arguments and import the file into the database</li> </ol> <h2 id=calibration-database>Calibration Database<a class=headerlink href=#calibration-database title="Permanent link">¶</a></h2> <p>After importing the database, two new alternatives should be added, the first one being the calibration name the users has defined, and the second one is the calibration alternative with the <em>CALIBRATION</em> entity class only</p> <p>In the calibration database, the following entity and parameter_name should be checked to get the correct value</p> <p>DEFAULT: Root = .\</p> <p>DEFAULT: RootPC = .\</p> <p>DEFAULT: Rootbasin = .\</p> <p>Path: Templates = settings_templates_CWatM</p> <p>Templates: ModelSettings = calib_cwatm.ini</p> <h2 id=creating-a-calibration-scenario>Creating a calibration scenario<a class=headerlink href=#creating-a-calibration-scenario title="Permanent link">¶</a></h2> <p>To run any calibration, one will need 1. a cwatm ini file against which the calibration is made, and a calibration file to know how to calibrate it.</p> <p>The first step is to recreate a valid CWatM file. If you have not imported any CWatM file into the database as a Base alternative, please go to have a look at the <a href=../Tutorial/#running-standalone-version>create a standalone model section</a>.</p> <p>Create a scenario named <em>calibration</em> and drag&amp;drop the cwatm base alternative and the <em>calibration</em> alternative and you should have this scenario displayed as below</p> <p><img alt=relink_tool src=../images/calibration_scenario.png></p> <p>Toolbox will now recreate the CWatM init file taking the base scenario input variables and add/replace the variables with the calibration data.</p> <h2 id=running-the-calibration>Running the calibration<a class=headerlink href=#running-the-calibration title="Permanent link">¶</a></h2> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>This section refers to the <a href=../navigating/#5-run-your-calibration>running calibration file in SpineToolbox</a> part of the workflow.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Remember to add your measurement files in the calibration tool defined. In the observed data, only those provided by CWatM community for their tutorial is added. Double click the Calibration tool &gt; in the Additional program files section, open the observed_data folder &gt; add your measurements csv (in the correct format as recommended by CWatM) </p> </div> <p>To run the calibration, we need to go through two steps. The first steps is to ensure we are creating the correct calibration init file to CWatM and create the correct CWatM init file to run the model in calibration mode</p> <p>The first step consists in selecting the correct <strong>alternative</strong> from the filter. Filter is displayed while selecting the yellow arrow connecting the database to the export_to_ini_calibtxt tool.</p> <p><img alt=relink_tool src=../images/calib_atl.png></p> <p>Then in the second flow, we are sending the calibration scenario we created earlier. Ensure you select only the calibration scenario from the link properties of the workflow.</p> <p><img alt=relink_tool src=../images/calib_scenario.png></p> <p>The last task is to ensure what will be the name of the alternative where you want to store the <strong><em>best</em></strong> results run from the calibration. You can rename the arguments <img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/31-20e3.svg title=:one:> freely.</p> <p><img alt=relink_tool src=../images/calib_best_scenario.png></p> <p>Select then the workflow and run the selection <img alt=selection_run_icon src=../images/selection_run_icon.png>.</p> <h2 id=results-and-running-best-calibration>Results and running best calibration<a class=headerlink href=#results-and-running-best-calibration title="Permanent link">¶</a></h2> <p>The calibration run will be committed to the database automatically under the <em>cwatm_best_test</em> alternative (or whatever the name of the alternative the use has defined)</p></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 - 2024 VTT - Design and Operation of Energy Systems </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>